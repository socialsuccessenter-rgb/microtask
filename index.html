<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Microtask V18 - Pro Max Edition</title>
    
    <script src='//libtl.com/sdk.js' data-zone='10582159' data-sdk='show_10582159'></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <style>
        :root { --primary: #3498db; --success: #2ecc71; --danger: #e74c3c; --bg: #f0f2f5; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; padding-bottom: 80px; overflow-x: hidden; }

        /* рж░рзЗржЗржи ржХрж╛рж░рзНржбрзЗрж░ рж╕рзНржкрзЗрж╢рж╛рж▓ ржбрж┐ржЬрж╛ржЗржи - рзй-рзк ржХрж╛рж▓рж╛рж░ ржкрзНрж░рж┐ржорж┐рзЯрж╛ржо ржПржирж┐ржорзЗрж╢ржи */
        .rain-card { 
            position: relative;
            background: linear-gradient(-45deg, #23a6d5, #23d5ab, #8e44ad, #2980b9);
            background-size: 400% 400%;
            animation: colorShift 10s ease infinite;
            color: white; 
            border-radius: 20px; 
            padding: 30px 25px; 
            box-shadow: 0 10px 25px rgba(0,0,0,0.1); 
            margin-bottom: 20px; 
            text-align: center;
            overflow: hidden; 
        }

        @keyframes colorShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .card-money {
            position: absolute;
            top: -20px;
            color: rgba(255, 255, 255, 0.7);
            font-size: 20px;
            pointer-events: none;
            z-index: 1;
            animation: cardFall linear forwards;
        }

        @keyframes cardFall {
            to { transform: translateY(250px); opacity: 0; }
        }

        .card-info { position: relative; z-index: 2; }

        .page { display: none; padding: 20px; }
        .active-page { display: block; }
        .card { background: white; border-radius: 20px; padding: 25px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); margin-bottom: 20px; text-align: center; }
        button { width: 100%; padding: 18px; border: none; border-radius: 12px; font-weight: bold; cursor: pointer; margin-top: 10px; transition: 0.3s; }
        .btn-ad { background: linear-gradient(135deg, #f39c12, #e67e22); color: white; }
        .bottom-nav { position: fixed; bottom: 0; width: 100%; background: white; display: flex; border-top: 1px solid #eee; height: 75px; z-index: 1000; }
        .nav-item { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 12px; color: #bdc3c7; cursor: pointer; }
        .nav-item.active { color: var(--primary); font-weight: bold; }
        .warning { color: var(--danger); font-size: 12px; font-weight: bold; margin-top: 5px; }
        input, select { width: 95%; padding: 15px; margin-top: 10px; border: 1px solid #ddd; border-radius: 10px; text-align: center; }
    </style>
</head>
<body>

    <div id="home" class="page active-page">
        <div class="rain-card" id="main-rain-card">
            <div class="card-info">
                <div style="font-size:18px; font-weight:bold; text-shadow: 1px 1px 4px rgba(0,0,0,0.3);">ЁЯСЛ рж╕рзНржмрж╛ржЧрждржо, <span id="user_name">...</span>!</div>
                <p style="opacity:0.9; margin: 5px 0;">ЁЯТ░ ржЖржкржирж╛рж░ ржмрзНржпрж╛рж▓рзЗржирзНрж╕ ЁЯТ░</p>
                <h1 id="bal_v" style="font-size: 45px; margin: 10px 0; text-shadow: 2px 2px 5px rgba(0,0,0,0.2);">0.00 рз│</h1>
                <p style="font-size: 12px; opacity: 0.8;">ЁЯМзя╕П ржЫрзЛржЯ ржЫрзЛржЯ ржХрж╛ржЬ ржХрж░рзЗ ржЯрж╛ржХрж╛ ржЗржиржХрж╛ржо ржХрж░рзБржи ЁЯМзя╕П</p>
            </div>
        </div>

        <div class="card">
            <p>ржмрж╛ржХрж┐ ржЕрзНржпрж╛ржб: <span id="ad_count" style="font-weight:bold; color:var(--primary);">...</span>/5</p>
            <p id="timer_box" style="display:none; color:var(--danger); font-weight:bold;">ржкрж░ржмрж░рзНрждрзА рзлржЯрж┐ ржЕрзНржпрж╛ржб ржЖрж╕ржмрзЗ: <span id="time_left"></span> ржорж┐ржирж┐ржЯ ржкрж░</p>
            <button class="btn-ad" id="ad_btn" onclick="watchAd()">ЁЯУ║ ржнрж┐ржбрж┐ржУ ржЕрзНржпрж╛ржб ржжрзЗржЦрзБржи (рзирз│)</button>
        </div>
    </div>

    <div id="tasks" class="page">
        <div class="card">
            <h2>ЁЯОп рж╕рзЛрж╢рзНржпрж╛рж▓ ржЯрж╛рж╕рзНржХ</h2>
            <p class="warning">тЪая╕П ржПржЯрж┐ ржПржХржмрж╛рж░ржЗ ржХрж░рж╛ ржпрж╛ржмрзЗред ржХрж╛ржЬ ржирж╛ ржХрж░рзЗ рж╕рж╛ржмржорж┐ржЯ ржХрж░рж▓рзЗ ржкрзЗржорзЗржирзНржЯ ржмрзНржпрж░рзНрже рж╣ржмрзЗред </p>
            <button style="background:#1877F2; color:white;" onclick="completeTask('fb', 5, 'https://www.facebook.com/share/1Dff8Nwu1o/')">Facebook ржкрзЗржЬ ржлрж▓рзЛ (рзлрз│)</button>
            <button style="background:#0088cc; color:white; margin-top:10px;" onclick="completeTask('tg', 3, 'https://t.me/microtask_earnmoney')">Telegram ржЪрзНржпрж╛ржирзЗрж▓ ржЬрзЯрзЗржи (рзйрз│)</button>
        </div>
    </div>

    <div id="refer" class="page">
        <div class="card">
            <h2>ЁЯСе рж░рзЗржлрж╛рж░рзЗрж▓ ржмрзЛржирж╛рж╕</h2>
            <p style="color:#2ecc71; font-weight:bold;">ржкрзНрж░рждрж┐ рж░рзЗржлрж╛рж░рзЗ рззрзй ржЯрж╛ржХрж╛!</p>
            <input type="text" id="ref_link" readonly>
            <button style="background:var(--primary); color:white;" onclick="copyRef()">рж▓рж┐ржВржХ ржХржкрж┐</button>
            <p style="margin-top:20px;">ржорзЛржЯ рж░рзЗржлрж╛рж░: <span id="ref_v">0</span></p>
        </div>
    </div>

    <div id="profile" class="page">
        <div class="card">
            <h2>ЁЯТ╕ ржЯрж╛ржХрж╛ ржЙрждрзНрждрзЛрж▓ржи</h2>
            <p class="warning" style="margin-bottom:10px;">ржнрзБрж▓ рждржерзНржп ржжрж┐рж▓рзЗ ржЖржкржирж╛рж░ ржПржХрж╛ржЙржирзНржЯ ржмрзНржпрж╛ржи рж╣рждрзЗ ржкрж╛рж░рзЗ!</p>
            <select id="method">
                <option value="bkash">ржмрж┐ржХрж╛рж╢</option>
                <option value="nagad">ржиржЧржж</option>
            </select>
            <input type="number" id="phone" placeholder="ржирж╛ржорзНржмрж╛рж░ ржжрж┐ржи">
            <input type="number" id="amount" placeholder="ржкрж░рж┐ржорж╛ржг (ржорж┐ржирж┐ржорж╛ржо рзнрзжрзжрз│)">
            <button id="withdraw_btn" style="background:#dfe6e9; color:#b2bec3;" disabled onclick="withdraw()">ржЯрж╛ржХрж╛ ржЙрждрзНрждрзЛрж▓ржи ржХрж░рзБржи</button>
        </div>
        <div class="card">
            <h2>ЁЯУв рж╕рж╛ржкрзЛрж░рзНржЯ ржЪрзНржпрж╛ржирзЗрж▓</h2>
            <button style="background:#0088cc; color:white;" onclick="window.open('https://t.me/microtask_earnmoney', '_blank')">ржЯрзЗрж▓рж┐ржЧрзНрж░рж╛ржо рж╕рж╛ржкрзЛрж░рзНржЯ</button>
        </div>
    </div>

    <div class="bottom-nav">
        <div class="nav-item active" onclick="showP('home', this)">ЁЯПа<br>рж╣рзЛржо</div>
        <div class="nav-item" onclick="showP('tasks', this)">ЁЯОп<br>ржЯрж╛рж╕рзНржХ</div>
        <div class="nav-item" onclick="showP('refer', this)">ЁЯСе<br>рж░рзЗржлрж╛рж░</div>
        <div class="nav-item" onclick="showP('profile', this)">ЁЯСд<br>ржкрзНрж░рзЛржлрж╛ржЗрж▓</div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        const uid = tg.initDataUnsafe.user ? tg.initDataUnsafe.user.id.toString() : "test_user";
        const dbURL = "https://earnmoneybot-8836f-default-rtdb.firebaseio.com/";

        let userData = { balance: 0, refs: 0, dailyAds: 5, lastReset: 0, tasks: {} };

        function createCardRain() {
            const card = document.getElementById('main-rain-card');
            if(!card) return;
            const drop = document.createElement('div');
            drop.innerText = 'рз│';
            drop.classList.add('card-money');
            drop.style.left = Math.random() * 90 + '%';
            drop.style.animationDuration = Math.random() * 1 + 1.5 + 's';
            card.appendChild(drop);
            setTimeout(() => drop.remove(), 2000);
        }
        setInterval(createCardRain, 400);

        async function loadData() {
            const res = await fetch(`${dbURL}/users/${uid}.json`);
            const data = await res.json();
            if (data) {
                userData = data;
                checkTimeLimit();
            } else {
                await saveToDB();
                handleRef();
            }
            updateUI();
        }

        async function saveToDB() {
            await fetch(`${dbURL}/users/${uid}.json`, { method: 'PUT', body: JSON.stringify(userData) });
        }

        function checkTimeLimit() {
            const now = Date.now();
            const waitTime = 3 * 60 * 60 * 1000; // рзй ржШржгрзНржЯрж╛
            if (userData.dailyAds === 0 && (now - userData.lastReset > waitTime)) {
                userData.dailyAds = 5;
                userData.lastReset = now;
                saveToDB();
            }
        }

        function watchAd() {
            if (userData.dailyAds > 0 && typeof show_10582159 === 'function') {
                show_10582159().then(() => {
                    tg.showAlert("ржЕрзНржпрж╛ржб рж╕ржорзНржкржирзНржи рж╣рзЯрзЗржЫрзЗ! рзл рж╕рзЗржХрзЗржирзНржб ржЕржкрзЗржХрзНрж╖рж╛ ржХрж░рзБржи...");
                    setTimeout(async () => {
                        userData.balance += 2;
                        userData.dailyAds -= 1;
                        if(userData.dailyAds === 0) userData.lastReset = Date.now();
                        await saveToDB();
                        updateUI();
                        tg.showAlert("рзи ржЯрж╛ржХрж╛ ржпрзЛржЧ рж╣рзЯрзЗржЫрзЗ!");
                    }, 5000); // рзирзж рж╕рзЗржХрзЗржирзНржб ржерзЗржХрзЗ ржХржорж┐рзЯрзЗ рзл рж╕рзЗржХрзЗржирзНржб ржХрж░рж╛ рж╣рзЯрзЗржЫрзЗ
                }).catch(() => tg.showAlert("ржЕрзНржпрж╛ржб ржмрзНржпрж░рзНрже!"));
            }
        }

        async function completeTask(type, reward, link) {
            if (!userData.tasks[type]) {
                window.open(link, '_blank');
                tg.showAlert("рзл рж╕рзЗржХрзЗржирзНржб ржкрж░ ржмрзЛржирж╛рж╕ ржпрзЛржЧ рж╣ржмрзЗ...");
                setTimeout(async () => {
                    userData.balance += reward;
                    userData.tasks[type] = true;
                    await saveToDB();
                    updateUI();
                    tg.showAlert(reward + " ржЯрж╛ржХрж╛ ржпрзЛржЧ рж╣рзЯрзЗржЫрзЗ!");
                }, 5000); // ржЯрж╛рж╕рзНржХрзЗрж░ ржХрзНрж╖рзЗрждрзНрж░рзЗржУ рзл рж╕рзЗржХрзЗржирзНржб ржХрж░рж╛ рж╣рзЯрзЗржЫрзЗ
            } else {
                tg.showAlert("ржПржЗ ржЯрж╛рж╕рзНржХ ржЖржЧрзЗржЗ ржХрж░рзЗржЫрзЗржи!");
            }
        }

        function updateUI() {
            document.getElementById('bal_v').innerText = userData.balance.toFixed(2);
            document.getElementById('ad_count').innerText = userData.dailyAds;
            document.getElementById('ref_v').innerText = userData.refs || 0;
            document.getElementById('user_name').innerText = tg.initDataUnsafe.user?.first_name || "ржЗржЙржЬрж╛рж░";
            document.getElementById('ref_link').value = "https://t.me/microtask_earnmoney_bot?start=" + uid;

            const adBtn = document.getElementById('ad_btn');
            const timerBox = document.getElementById('timer_box');
            const timeLeftSpan = document.getElementById('time_left');

            const now = Date.now();
            const waitTime = 3 * 60 * 60 * 1000; // рзй ржШржгрзНржЯрж╛ (рззрзорзж ржорж┐ржирж┐ржЯ)
            const timePassed = now - userData.lastReset;

            if (userData.dailyAds === 0) {
                if (timePassed >= waitTime) {
                    userData.dailyAds = 5;
                    saveToDB();
                    adBtn.style.display = "block";
                    timerBox.style.display = "none";
                } else {
                    adBtn.style.display = "none";
                    timerBox.style.display = "block";
                    const diffMin = Math.ceil((waitTime - timePassed) / 60000);
                    timeLeftSpan.innerText = diffMin > 0 ? diffMin : 0;
                }
            } else {
                adBtn.style.display = "block";
                timerBox.style.display = "none";
            }

            const wBtn = document.getElementById('withdraw_btn');
            if (userData.balance >= 700 && userData.refs >= 10) {
                wBtn.disabled = false; wBtn.style.background = "#2ecc71"; wBtn.style.color = "white";
            }
        }

        setInterval(updateUI, 30000); // рзйрзж рж╕рзЗржХрзЗржирзНржб ржкрж░ржкрж░ рж░рж┐ржлрзНрж░рзЗрж╢ рж╣ржмрзЗ

        async function handleRef() {
            const params = new URLSearchParams(window.location.search);
            const refID = params.get('start');
            if (refID && refID !== uid) {
                const res = await fetch(`${dbURL}/users/${refID}.json`);
                let boss = await res.json();
                if (boss) {
                    boss.balance += 13; boss.refs += 1;
                    await fetch(`${dbURL}/users/${refID}.json`, { method: 'PUT', body: JSON.stringify(boss) });
                }
            }
        }

        function showP(id, el) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active-page'));
            document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
            document.getElementById(id).classList.add('active-page');
            el.classList.add('active');
        }

        function copyRef() {
            document.getElementById("ref_link").select();
            document.execCommand("copy");
            tg.showAlert("рж▓рж┐ржВржХ ржХржкрж┐ рж╣рзЯрзЗржЫрзЗ!");
        }

        loadData();
    </script>
</body>
</html>
