<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Microtask Earn Money</title>

    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <style>
        body { font-family: 'Arial', sans-serif; background: #f4f7f6; margin: 0; padding-bottom: 80px; }
        .page { display: none; padding: 20px; animation: fadein 0.5s; }
        .active-page { display: block; }
        @keyframes fadein { from { opacity: 0; } to { opacity: 1; } }

        .card { background: white; border-radius: 15px; padding: 20px; box-shadow: 0 2px 10px (0,0,0,0.1); margin-bottom: 15px; text-align: center; }
        button { width: 100%; padding: 14px; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; margin-top: 10px; font-size: 16px; }

        .bottom-nav { position: fixed; bottom: 0; width: 100%; background: white; display: flex; justify-content: space-around; padding: 10px 0; border-top: 1px solid #ddd; z-index: 1000; }
        .nav-item { text-align: center; font-size: 12px; color: #777; cursor: pointer; flex: 1; }
        .nav-item.active { color: #3498db; font-weight: bold; }
        .nav-icon { font-size: 20px; margin-bottom: 2px; }

        input { width: 90%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 8px; font-size: 14px; }
        .ref-box { background: #eee; padding: 10px; border-radius: 8px; word-break: break-all; font-size: 12px; margin: 10px 0; }
    </style>
</head>
<body>

<div id="home" class="page active-page">
    <div class="card">
        <h2>üí∞ ‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶°</h2>
        <p>‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏</p>
        <h1><span id="home_balance">0</span> ‡ß≥</h1>
    </div>
    <div class="card">
        <h3>‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶¶‡ßá‡¶ñ‡ßá ‡¶Ü‡ßü</h3>
        <button style="background:#e67e22;color:#fff" onclick="showAd()">üì∫ ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° (‡ß®‡ß≥)</button>
    </div>
</div>

<div id="task" class="page">
    <div class="card">
        <h3>üéØ ‡¶∏‡ßã‡¶∂‡ßç‡¶Ø‡¶æ‡¶≤ ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï</h3>
        <button style="background:#1877f2;color:#fff" onclick="doTask('fb','https://www.facebook.com/share/1AYqvgHGGs/',5)">üîµ ‡¶´‡ßá‡¶∏‡¶¨‡ßÅ‡¶ï ‡¶´‡¶≤‡ßã</button>
        <button style="background:#ff0000;color:#fff" onclick="doTask('yt','https://www.youtube.com/@arshoppingmalls',5)">üî¥ ‡¶á‡¶â‡¶ü‡¶ø‡¶â‡¶¨ ‡¶∏‡¶æ‡¶¨‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶æ‡¶á‡¶¨</button>
    </div>
</div>

<div id="profile" class="page">
    <div class="card">
        <h3>üë§ ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤</h3>
        <p>ID: <span id="u_id"></span></p>
        <p>‡¶∞‡ßá‡¶´‡¶æ‡¶∞: <span id="ref_count">0</span></p>
        <input type="number" id="withdrawAmount" placeholder="‡¶ü‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ (‡ß≠‡ß¶‡ß¶+)">
        <input type="text" id="bkashNumber" placeholder="‡¶¨‡¶ø‡¶ï‡¶æ‡¶∂ / ‡¶®‡¶ó‡¶¶ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞">
        <button style="background:#3498db;color:#fff" onclick="checkAndWithdraw()">‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞</button>
    </div>
</div>

<div class="bottom-nav">
    <div class="nav-item active" onclick="showPage('home')"><div class="nav-icon">üè†</div>‡¶π‡ßã‡¶Æ</div>
    <div class="nav-item" onclick="showPage('task')"><div class="nav-icon">üìã</div>‡¶ü‡¶æ‡¶∏‡ßç‡¶ï</div>
    <div class="nav-item" onclick="showPage('profile')"><div class="nav-icon">üë§</div>‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤</div>
</div>

<script>
const tg = window.Telegram.WebApp;
tg.expand();

/* Firebase */
firebase.initializeApp({
    apiKey: "AIzaSyDwjqWl4Qto-n06g2SVGlf4IKKArRnAKBQ",
    authDomain: "earnmoneybot-8836f.firebaseapp.com",
    databaseURL: "https://earnmoneybot-8836f-default-rtdb.firebaseio.com",
    projectId: "earnmoneybot-8836f"
});
const database = firebase.database();

/* USER */
const user = tg.initDataUnsafe.user;
const userId = user ? String(user.id) : "user_test_mode";
document.getElementById("u_id").innerText = userId;

const userRef = database.ref("users/" + userId);

/* INIT */
userRef.once("value").then(s=>{
    if(!s.exists()){
        userRef.set({balance:0,ref_count:0});
    }
});

/* REALTIME LISTENER */
userRef.on("value",snap=>{
    const d = snap.val();
    if(d){
        document.getElementById("home_balance").innerText = d.balance || 0;
        document.getElementById("ref_count").innerText = d.ref_count || 0;
    }
});

/* SAFE BALANCE UPDATE */
function updateBalance(amount){
    userRef.child("balance").transaction(curr=>{
        return (curr||0)+amount;
    });
}

function showAd(){
    updateBalance(2);
    alert("‡¶∏‡¶´‡¶≤! ‡ß® ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶Ø‡ßã‡¶ó ‡¶π‡ßü‡ßá‡¶õ‡ßá");
}

function doTask(t,u,r){
    window.open(u,"_blank");
    setTimeout(()=>{
        updateBalance(r);
        alert(r+"‡ß≥ ‡¶Ø‡ßã‡¶ó ‡¶π‡ßü‡ßá‡¶õ‡ßá");
    },5000);
}

function checkAndWithdraw(){
    const amt = Number(document.getElementById("withdrawAmount").value);
    const num = document.getElementById("bkashNumber").value;
    if(amt<700) return alert("‡¶Æ‡¶ø‡¶®‡¶ø‡¶Æ‡¶æ‡¶Æ ‡ß≠‡ß¶‡ß¶‡ß≥+ ‡ßß‡ß¶‡¶ü‡¶ø ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡ßü‡ßã‡¶ú‡¶®");
    if(!num) return alert("‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶¶‡¶ø‡¶®");

    database.ref("withdraw_requests").push({
        userId,amount:amt,number:num,status:"Pending",time:new Date().toLocaleString()
    }).then(()=>{
        updateBalance(-amt);
        alert("‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶π‡ßü‡ßá‡¶õ‡ßá");
    });
}

function showPage(id){
    document.querySelectorAll(".page").forEach(p=>p.classList.remove("active-page"));
    document.getElementById(id).classList.add("active-page");
    document.querySelectorAll(".nav-item").forEach(n=>n.classList.remove("active"));
    event.currentTarget.classList.add("active");
}
</script>
</body>
</html>
        let currentBalance = 0;
        let totalRefer = 0;

        // ‡¶°‡¶æ‡¶ü‡¶æ‡¶¨‡ßá‡¶∏ ‡¶•‡ßá‡¶ï‡ßá ‡¶∞‡¶ø‡ßü‡ßá‡¶≤ ‡¶ü‡¶æ‡¶á‡¶Æ ‡¶°‡¶æ‡¶ü‡¶æ ‡¶Ü‡¶®‡¶æ
        database.ref('users/' + userId).on('value', (snapshot) => {
            const data = snapshot.val();
            if (data) {
                currentBalance = data.balance || 0;
                totalRefer = data.ref_count || 0;
                document.getElementById('home_balance').innerText = currentBalance;
                document.getElementById('ref_count').innerText = totalRefer;
            } else {
                database.ref('users/' + userId).set({ balance: 0, ref_count: 0 });
            }
        });

        // ‡¶™‡ßá‡¶ú ‡¶®‡ßç‡¶Ø‡¶æ‡¶≠‡¶ø‡¶ó‡ßá‡¶∂‡¶®
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active-page'));
            document.getElementById(pageId).classList.add('active-page');
            
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            const navItems = document.querySelectorAll('.nav-item');
            if(pageId === 'home') navItems[0].classList.add('active');
            if(pageId === 'task') navItems[1].classList.add('active');
            if(pageId === 'profile') navItems[2].classList.add('active');
            if(pageId === 'support') navItems[3].classList.add('active');
        }

        // ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
        function showAd() {
            // ‡¶è‡¶ñ‡¶æ‡¶®‡ßá Monetag SDK ‡¶ï‡¶≤ ‡¶π‡¶¨‡ßá
            updateBalance(2);
            alert("‡¶∏‡¶´‡¶≤! ‡ß® ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§");
        }

        function updateBalance(amount) {
            currentBalance += amount;
            database.ref('users/' + userId).update({ balance: currentBalance });
        }

        function doTask(name, url, reward) {
            window.open(url, '_blank');
            setTimeout(() => {
                updateBalance(reward);
                alert("‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶≠‡ßá‡¶∞‡¶ø‡¶´‡¶æ‡¶á‡¶°! " + reward + "‡ß≥ ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶Ø‡ßã‡¶ó ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§");
            }, 5000);
        }

        // ‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞ ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ
        function checkAndWithdraw() {
            const amount = document.getElementById('withdrawAmount').value;
            const number = document.getElementById('bkashNumber').value;

            if (totalRefer < 10) {
                alert("‡¶¶‡ßÅ‡¶É‡¶ñ‡¶ø‡¶§! ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶§‡ßÅ‡¶≤‡¶§‡ßá ‡¶Ö‡¶®‡ßç‡¶§‡¶§ ‡ßß‡ß¶ ‡¶ü‡¶ø ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶•‡¶æ‡¶ï‡¶§‡ßá ‡¶π‡¶¨‡ßá‡•§ ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶∞‡ßá‡¶´‡¶æ‡¶∞: " + totalRefer);
                return;
            }
            if (amount < 700) {
                alert("‡¶¶‡ßÅ‡¶É‡¶ñ‡¶ø‡¶§! ‡¶∏‡¶∞‡ßç‡¶¨‡¶®‡¶ø‡¶Æ‡ßç‡¶® ‡ß≠‡ß¶‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶®‡¶æ ‡¶π‡¶≤‡ßá ‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡¶¨‡ßá ‡¶®‡¶æ‡•§");
                return;
            }
            if (amount > currentBalance) {
                alert("‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü‡ßá ‡¶™‡¶∞‡ßç‡¶Ø‡¶æ‡¶™‡ßç‡¶§ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶®‡ßá‡¶á‡•§");
                return;
            }
            if (!number) {
                alert("‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶™‡ßç‡¶∞‡¶¶‡¶æ‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®‡•§");
                return;
            }

            database.ref('withdraw_requests/').push({
                userId: userId,
                name: user ? user.first_name : "Unknown",
                amount: amount,
                phone: number,
                status: "Pending",
                time: new Date().toLocaleString()
            }).then(() => {
                updateBalance(-amount);
                alert("‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü ‡¶∏‡¶´‡¶≤! ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡ß®‡ß™ ‡¶ò‡¶£‡ßç‡¶ü‡¶æ‡¶∞ ‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶ï‡¶∞‡ßá ‡¶¶‡ßá‡¶¨‡ßá‡•§");
            });
        }

        function copyRef() {
            const tempInput = document.createElement("input");
            tempInput.value = refLink;
            document.body.appendChild(tempInput);
            tempInput.select();
            document.execCommand("copy");
            document.body.removeChild(tempInput);
            alert("‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï ‡¶ï‡¶™‡¶ø ‡¶π‡ßü‡ßá‡¶õ‡ßá!");
        }
    </script>
</body>
</html>


